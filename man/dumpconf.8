.TH DUMPCONF 8 "Nov 2006" "s390-tools"

.SH NAME
dumpconf \- Configure automatic dump for Linux on z/Series.

.SH SYNOPSIS
.br
\fBdumpconf\fR [start|stop|status]
.br
\fBdumpconf\fR [-h|-v]

.SH DESCRIPTION
\fBdumpconf\fR reads /etc/sysconfig/dumpconf and initializes the automatic dump
feature according to the configuration file.

The following keywords can be used in the dumpconf file:

.TP
\fB  - ON_PANIC:\fR
Shutdown action in case of a kernel panic. Possible values are 'dump', 'reipl', 'dump_reipl', 'stop' and 'vmcmd':
.br

dump: trigger dump according to configuration in /etc/sysconfig/dumpconf.
.br

reipl: trigger re-IPL according to configuration under /sys/firmware/reipl.
.br

dump_reipl: first trigger dump according to configuration in
/etc/sysconfig/dumpconf, then trigger re-IPL according to configuration under
/sys/firmware/reipl.
.br

stop: stop Linux and enter disabled wait (default).
.br

vmcmd: trigger vm command according to 'VMCMD_X' configuration in /etc/sysconfig/dumpconf.

.TP
\fB  - DUMP_TYPE:\fR
Type of dump device. Possible values are 'ccw' and 'fcp'.

.TP
\fB  - DEVICE:\fR
Device number of dump device.

.TP
\fB  - WWPN\fR
WWPN for scsi dump device.

.TP
\fB  - LUN\fR
LUN for scsi dump device.

.TP
\fB  - BOOTPROG:\fR
Boot program selector

.TP
\fB  - BR_LBA:\fR
Boot record logical block address.

.TP
\fB  - VMCMD_1, VMCMD_2 ... VMCMD_5:\fR
Up to five CP commands, which are triggered in case of a kernel panic.

.SH Reboot loop considerations

If you select the shutdown actions "reipl" or "dump_reipl", in rare cases a
"reboot loop" can occur, if the Linux kernel crashes everytime after the
reboot. If you want to prevent that scenario, one of the following two
approaches can be taken:

1. Manual activation of dumpconf

Ensure that the dumpconf service is not active by default:
.br
# chkconfig --del dumpconf

Start dumpconf service manually:
.br
# service dumpconf start

When your Linux system crashes, the system will be rebooted (after creating
a dump in case of dump_reipl). Because the dumpconf script will then not be
activated automatically, a second crash will stop the system.

2. Automatic delayed activation of dumpconf

Ensure that the dumpconf service is not active by default:
.br
# chkconfig --del dumpconf

To enable delayed activation one of the following methods can be used:
  a) Use a init script (e.g. /etc/rc.d/boot.local):
     (sleep 10m; /sbin/service dumpconf start) &

  b) Use a init script (e.g. /etc/rc.d/boot.local) together with "at":
     echo 'echo /sbin/service dumpconf start' |at now+10min

  c) Use the following crontab entry:
     @reboot sleep 10m && /sbin/service dumpconf start

In these examples, when your Linux system crashes within 10 minutes after
the reboot, the dumpconf script is not active and a second crash will stop
the system.

.SH COMMANDS
.TP
\fBstart\fR
Enable configuration defined in /etc/sysconfig/dumpconf.

.TP
\fBstop\fR
Disable dump configuration.

.TP
\fBstatus\fR
Show current configuration.

.SH OPTIONS
.TP
\fB-h\fR or \fB--help\fR
Print usage information, then exit.

.TP
\fB-v\fR or \fB--version\fR
Print version information, then exit.

.SH EXAMPLES:
The following are examples for /etc/sysconfig/dumpconf:
.br

#
.br
# Example config for CCW dump device (DASD)
.br
#
.br
ON_PANIC=dump_reipl
.br
DUMP_TYPE=ccw
.br
DEVICE=0.0.4714
.br

#
.br
# Example config for FCP dump device (SCSI Disk)
.br
#
.br
ON_PANIC=dump
.br
DUMP_TYPE=fcp
.br
DEVICE=0.0.4711
.br
WWPN=0x5005076303004712
.br
LUN=0x4713000000000000
.br
BOOTPROG=0
.br
BR_LBA=0
.br

#
.br
# Example config for vm command on panic
.br
#
.br
ON_PANIC=vmcmd
.br
VMCMD_1="MESSAGE * Starting VMDUMP"
.br
VMCMD_2="VMDUMP"
.br
VMCMD_3="IPL 4711"

#
.br
# Example config for re-IPL on panic
.br
#
.br
ON_PANIC=reipl

.SH SEE ALSO
Linux on zSeries: Using the Dump Tools
